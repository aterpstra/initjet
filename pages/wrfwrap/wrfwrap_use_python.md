---
title: Use wrf-wrap to run a WRF simulation
#keywords: sample
summary: "How to use wrf-wrap to run a default WRF simulation without the scheduler"
sidebar: wrfwrap_sidebar
permalink: wrfwrap_use_python.html
folder: wrfwrap
---

## WRF wrapper process 

The default WRF wrapper creates intermediate files for all input data (ungrib.exe), which are merged with the geo-static data into input-files for WRF (metgrid.exe), thereafter the WRF-model is initialised (real.exe) and run (wrf.exe). 

{% include note.html content='WRF geo-static files (created with geogrid.exe) are not generated by the WRF wrapper. Running geogrid.exe requires large geo-static input-data sets (~30-100GB) and the output files (geo_em.d0\<x\>.nc) are domain specific static files, i.e. they are reusable.'%}


## Run a WRF simulation using wrf-wrap Docker image


### Pre-requistics

Local access is needed to:
1. WRF native configuration files (i.e. namelists, .TBL, Vtables, ...)  
2. WPS static files (i.e. geo_em.d0\<x\>.nc files) 
3. forcing data (i.e. atmos, ocean, ...) 

### Start a container

Start a wrf-wrap container with the required volumes mounted:

	docker run -ti -v <local_dir_wrf-static>:/static/wrf-static/
					-v <local_dir_wrf-config>:/config/wrf-config/
					-v <local_dir_forcing-data>:/data/
					wrf4.2-wrap-gnu:latest

To start the container in an environment emulating MOS-operational setup: 

	docker run -ti -v /static:/static -v /config:/config -v /data:/data -v /scratch:/scratch -v /logs:/logs -v /flush:/flush metocean/wrf:wrf4.2-wrap-gnu-main



### Create a configuration file

Create an action file (.yaml) to configure wrf-wrap. 

Details regarding wrf-wrap action files are in [WRF wrapper actions](wrfwrap_actions.html)

The minimum ingredients are:

	id: tiny-gfs025-default  # the ID must be available as a directory in wrf-config and wrf-static

	dirs: 
	  static: /static/wrf-static/  # location of wrf-static 
	  config: /config/wrf-config/  # location of wrf-config
	  work: /scratch/  # location of a work directory, modelling components are copied and executed here

	nests: #define number of nests and their start/end times in hours
	    1:
	      start: 0
	      end: 6

	input_data:  # which forcing data to use
	  meteo:
	    basefile: /data/gfs/global_025/gfs.t%Hz.pgrb2.0p25.f%%f3  #input data
	    vtable: Vtable.GFS  # Vtable associated with input data (has to be available in wrf-config)
	    start: 0
	    end: 6
	    increment: 3

### Run WRF-model

Run the following python code inside the container to execute a WRF simulation using the WRF wrapper

	import yaml
	import datetime
	import wrf_wrap.wrapper as wrf_wrapper

	# load the config-file
	wrf_config =  yaml.load(
	open('<my_config_script>.yaml'), 
	Loader=yaml.Loader)
	
	# create WRF wrapper
	wrapper = wrf_wrapper.WRFwrapper(**wrf_config)

	# set cycle and run WRF
	wrapper.set_cycle(datetime.datetime(2021,8,1,0))
	wrapper.run()

{% include tip.html content="In wrf-wrap/docs/examples/ there is a script (run_wrf_local.py) to run wrf-wrap locally." %}

## Related MetOcean WRF modelling resources

MetOcean WRF modelling configuration, static and action files:

- [metocean/wrf-static](https://github.com/metocean/wrf-static) for pre-created WRF static files

- [metocean/wrf-config](https://github.com/metocean/wrf-config) for native WRF configuration files

- [metocean/wrf-action](https://github.com/metocean/wrf-action) for actions files

To setup a new domain, see: [metocean/wrf-pre](https://github.com/metocean/wrf-pre).

{% include links.html %}
